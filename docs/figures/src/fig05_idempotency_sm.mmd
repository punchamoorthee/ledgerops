%%{init: {"theme":"neutral","themeVariables":{
  "fontFamily":"Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto",
  "primaryColor":"#40826D","primaryBorderColor":"#40826D","primaryTextColor":"#0a0a0a",
  "lineColor":"#40826D","tertiaryColor":"#ffffff"}}}%%
stateDiagram-v2
  direction LR

  [*] --> New
  New --> In_Progress: POST(K) [!exists(K)]

  In_Progress --> In_Progress: POST(K) [exists && in_progress] / 202 (poll)
  In_Progress --> In_Progress: GET /transfers/{id} [in_progress] / 202
  In_Progress --> Completed: process & commit

  state "Replay" as Replay
  Completed --> Replay: POST(K) [exists && completed]
  Replay --> Completed: return stored result / 200

  Completed --> Completed: GET /transfers/{id} [completed] / 200
  Completed --> Completed: POST(K) [exists && completed] / 200
  Completed --> [*]